<html>
<!-- Head tag -->
<head>
  <meta charset="UTF-8">

  
  <title>
    Gym103409H Popcount Words 解题报告 |
    Ignotus&#39;s
  </title>
  


  <meta name="description" content="01trie+AC自动机+倍增，巧妙普适的思想">
  <meta name="author" content="John F. Xie">
  <meta property="og:title" content="Gym103409H Popcount Words 解题报告" />
  <meta property="og:description" content="01trie+AC自动机+倍增，巧妙普适的思想" />
  <meta property='og:site_name' content='Ignotus&#39;s' />
  <meta property="og:image" content="http://ignotus0.github.io/img/default.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:description" content="01trie+AC自动机+倍增，巧妙普适的思想" />
  <meta name="twitter:title" content="Gym103409H Popcount Words 解题报告" />

  <meta name="twitter:image" content="http://ignotus0.github.io/img/default.jpg" />

  <script src="https://www.amcharts.com/lib/4/core.js"></script>
  <script src="https://www.amcharts.com/lib/4/charts.js"></script>
  <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

  <link rel="stylesheet" href="https://unpkg.zhimg.com/bootstrap@4.1.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
    crossorigin="anonymous">
  
<link rel="stylesheet" href="/css/style.css">


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <!-- Menu -->
    <nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark page-navbar gradient">
  <div class="container">
    <a class="navbar-brand logo" href="http://ignotus0.github.io">
      Ignotus&#39;s</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item item">
          
        <li class="nav-item item">
          <a class="nav-link" href="/">
            Home</a>
        </li>
        
        <li class="nav-item item">
          <a class="nav-link" href="/archives">
            Archives</a>
        </li>
        
        <li class="nav-item item">
          <a class="nav-link" target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/197717">
            Luogu</a>
        </li>
        
        <li class="nav-item item">
          <a class="nav-link" target="_blank" rel="noopener" href="https://hexo.io/">
            Hexo</a>
        </li>
        
        <li class="nav-item item">
          <a class="nav-link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1GJ411x7h7">
            ???</a>
        </li>
        
        </li>
      </ul>
    </div>
  </div>
</nav>

    <main class="page main-page">
        <div class="container blogPost">
    <div class="row">
        <div class="col-sm-9 px-md-5">
            <h2 class="blog-post-title">
                Gym103409H Popcount Words 解题报告
            </h2>
            <p class="meta">
                <i class="far fa-clock"></i>
                2022-01-24 
            </p>
            <!-- Content -->
            <p>值得借鉴的神仙倍增思路。</p>
<p>发现 $\text{popcount}(x) \bmod 2$ 有倍增对称性。记原题 $w(0,2^k-1)$ 表示的串为 $w_{k,0}$，$w(0,2^k-1)$ 按位取反表示的串为 $w_{k,1}$，有下列递推式：</p>
<script type="math/tex; mode=display">
w_{0,0}=0,w_{0,1}=1\\
w_{i,0}=w_{i-1,0}+w_{i-1,1}\\
w_{i,1}=w_{i-1,1}+w_{i-1,0}</script><p>由上式可知：任意 $w(l,r)$ 都可以由 $\log r$ 个 $w$ 串相加得到。</p>
<p>将原题 $n$ 个区间分解，得到 $n\log V$ 个区间 $w_{k,i}$。</p>
<p>对于所有询问串，建立 AC 自动机，基本的做法是将原串 $S$ 在 AC 自动机上跑一遍，统计每个询问串对应节点 fail 树的子树和。</p>
<p>本题不能暴力将串 $S$ 输入进自动机，但字符串具有可倍增的性质，考虑 dp。设 $f_{0/1,k,u}$ 为当前在 $u$ 节点，在 AC 自动机上继续走 $2^k$ 个节点，$0/1$ 代表当前走的串是 $w_{k,0}$ 还是 $w_{k,1}$，能到达哪个节点，倍增转移。</p>
<p>有了 $f$ 数组，我们可以利用类似打标记的思想，设 $g_{0/1,k,u}$ 为有多少个区间 $w_{k,0/1}$ 以 $u$ 为起点，倒序倍增下传标记。最后对于每个自动机上的节点 $u$，答案为 $g_{0,0,u}+g_{1,0,u}$。最后输出作为询问串结尾节点 fail 树子树的点权和即可。</p>
<p>核心代码如下：</p>
<p>分解 $w(l,r)$：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>.<span class="built_in">split</span>(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr, <span class="keyword">int</span> coef)&#123;</span><br><span class="line">    <span class="keyword">if</span>(ql == l &amp;&amp; r == qr) <span class="keyword">return</span> vec.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(coef &amp; <span class="number">1</span>, __lg(qr - ql + <span class="number">1</span>))), <span class="built_in"><span class="keyword">void</span></span>();</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(qr &lt;= mid) <span class="built_in">split</span>(l, mid, ql, qr, coef);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(ql &gt; mid) <span class="built_in">split</span>(mid + <span class="number">1</span>, r, ql, qr, coef + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">split</span>(l, mid, ql, mid, coef), <span class="built_in">split</span>(mid + <span class="number">1</span>, r, mid + <span class="number">1</span>, qr, coef + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>$f$ 数组的倍增转移：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tot; ++i) f[<span class="number">0</span>][<span class="number">0</span>][i] = ch[i][<span class="number">0</span>], f[<span class="number">1</span>][<span class="number">0</span>][i] = ch[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">29</span>; ++i)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= tot; ++j)&#123;</span><br><span class="line">        f[<span class="number">0</span>][i][j] = f[<span class="number">1</span>][i - <span class="number">1</span>][f[<span class="number">0</span>][i - <span class="number">1</span>][j]];</span><br><span class="line">        f[<span class="number">1</span>][i][j] = f[<span class="number">0</span>][i - <span class="number">1</span>][f[<span class="number">1</span>][i - <span class="number">1</span>][j]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>$g$ 数组的倍增转移：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">29</span>; i &gt;= <span class="number">1</span>; --i)&#123;</span><br><span class="line">    <span class="keyword">for</span>(ll j = <span class="number">0</span>, t; j &lt;= tot; ++j)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t = g[<span class="number">0</span>][i][j]) g[<span class="number">0</span>][i - <span class="number">1</span>][j] += t, g[<span class="number">1</span>][i - <span class="number">1</span>][f[<span class="number">0</span>][i - <span class="number">1</span>][j]] += t;</span><br><span class="line">        <span class="keyword">if</span>(t = g[<span class="number">1</span>][i][j]) g[<span class="number">1</span>][i - <span class="number">1</span>][j] += t, g[<span class="number">0</span>][i - <span class="number">1</span>][f[<span class="number">1</span>][i - <span class="number">1</span>][j]] += t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

            <br />
            <p class="meta">
                

<a href="/tags/Solutions/"> <i class="fas fa-tags"></i>
    Solutions </a>

            </p>
        </div>

        <div class="col-sm-3">
             
<span><b> Welcome!</b></span>
<p>
	Hang around and make yourself at home.
</p>
<hr />


<span><b> Updates may be slow</b></span>
<p>
	Due to unstable connection to GitHub, blog posts may not be up-to-date.
</p>
<hr />

 

        </div>
    </div>
</div>
<!-- Menu fade on scroll -->
<script>
    var isScrolling;
    var prevScrollpos = window.pageYOffset;
    window.addEventListener(
        'scroll',
        function(event) {
            window.clearTimeout(isScrolling);
            isScrolling = setTimeout(function() {
                var currentScrollPos = window.pageYOffset;
                if (prevScrollpos > currentScrollPos) {
                    $('#navbar').slideDown();
                } else {
                    $('#navbar').slideUp();
                }
                prevScrollpos = currentScrollPos;
            }, 66);
        },
        false
    );
</script>


<a class="float-left gradient btn paginationbtn" href="/2022/01/计数题选做/"><i class="fas fa-chevron-left"></i></a>


    </main>
    <!-- Footer -->
    <footer class="page-footer">
  <div class="container">
    <div class="social-icons">
      
      <a href="https://ignotus0.github.io/" title="Home" target="_blank" rel="noopener" class="fas fa-home"></a>
      
      <a href="https://github.com/RandomAdversary/Gradient/issues" title="Report issue" target="_blank" rel="noopener" class="fas fa-bug"></a>
      
      <a href="/1970/01/友情链接/" title="Friends" target="_blank" rel="noopener" class="fas fa-user-friends"></a>
      
      <a href="https://github.com/Ignotus0" title="GitHub" target="_blank" rel="noopener" class="fab fa-github"></a>
      
    </div>
  </div>
</footer>
    <!-- After footer scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.loli.net/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
<script src="https://unpkg.zhimg.com/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!-- script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>